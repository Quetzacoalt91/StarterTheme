language: php

services:
  - docker

addons:
    apt:
        packages:
        - postfix
        - libappindicator1
        - fonts-liberation
    sauce_connect: true

cache:
  directories:
    - $HOME/.npm

sudo: required
dist: trusty
group: edge

env:
#  - PHP_VERSION=5.4
#  - PHP_VERSION=5.5
#  - PHP_VERSION=5.6
  - PHP_VERSION=7

matrix:
  fast_finish: true

before_install:
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -i google-chrome*.deb

before_script:
  - docker run -p 80:80 -tid --name=prestashop -v $TRAVIS_BUILD_DIR:/var/www/html/themes/StarterTheme prestashop/prestashop-git:$PHP_VERSION
  - docker exec -ti prestashop rm -Rf themes/classic
  - cp config/theme.dist.yml config/theme.yml
  - docker exec -ti prestashop php install-dev/index_cli.php --db_create=1 --db_password=admin --name=prestashop.unit.test --password=123456789
  - bash ./travis-scripts/wait-for-ps.sh
  - export CHROME_BIN=/usr/bin/google-chrome

notifications:
  email: false

script:
  - curl http://localhost/

after_script:
  - docker logs prestashop
  - google-chrome --version

after_failure:
